# UI Components

本文件冻结“添加设备（含自动发现）”相关 UI 组件的关键 props 与跨组件共享的数据形状（TypeScript 形状）。

## Shared domain shapes

```ts
export type DiscoveredDevice = {
  // The URL Web will store as baseUrl when adding the device.
  // Examples: "http://isolapurr-usb-hub-aabbcc.local" / "http://192.168.1.42"
  baseUrl: string;

  // Prefer device_id from GET /api/v1/info.
  device_id?: string;
  hostname?: string;
  fqdn?: string;
  ipv4?: string;
  variant?: string;
  firmware?: { name: string; version: string };

  // ISO8601 string generated by the UI (scan time) or derived from device uptime sampling.
  last_seen_at?: string;
};

export type DiscoveryStatus = "idle" | "scanning" | "ready" | "unavailable";

export type DiscoveryMode = "service" | "scan";

export type DiscoverySnapshot = {
  mode: DiscoveryMode;
  status: DiscoveryStatus;
  devices: DiscoveredDevice[];
  error?: string; // user-readable short message

  // Only present when mode === "scan".
  scan?: { cidr: string; done: number; total: number };

  // UI state for the advanced IP scan section (collapsed by default).
  ipScan?: {
    expanded: boolean;
    expandedBy?: "user" | "auto";
    autoExpandAfterMs?: number; // e.g. 30000
  };
};
```

## `AddDeviceDialog`（Modify）

> 目标：保持对外 props 尽量稳定（对齐现有 `AddDeviceDialog`），内部 UI 扩展为 “Discovery + Manual” 双栏。

```ts
export type AddDeviceDialogProps = {
  open: boolean;
  existingDeviceIds?: string[];
  onClose: () => void;
  onCreate: (input: { name: string; baseUrl: string; id?: string }) => void;
};
```

### `AddDeviceDialog` interaction notes

- Desktop：两列布局（左 Discovery / 右 Manual），右侧 `Create` 不得因 discovery 状态被禁用。
- Discovery 选择行为：
  - 选择某条 `DiscoveredDevice` 后：右侧表单自动填充 `Base URL`；
  - `ID` 建议填充为 `device_id`（若存在）；`Name` 建议填充为 `hostname`（若存在）。
- 去重显示：
  - 如果 `device_id` 已存在于 `existingDeviceIds`：左侧条目标记为 `Added` 并禁用 `Add`。
  - 若 `device_id` 缺失：回退用 `baseUrl` 做去重（实现细节放在 Web domain 层）。
- IP scan（advanced）：
  - 默认折叠为一行（文本链接 `Show`/`Hide`），避免长期占用列表可视空间。
  - 图标：Iconify `tabler:chevron-down` / `tabler:chevron-up`（文本左、图标右）。
  - 若 30 秒内没有发现任何新设备且仍未展开：允许自动展开并提示用户可尝试 IP scan。
- 提示/空态样式：
  - 说明类文案（例如“mDNS Desktop App only / Discovery unavailable / PNA 权限提示”）使用 `alert`/inline callout（单层容器 + icon + 文案 + link/按钮），避免 `card` 嵌套与重复标题。

## `DeviceDiscoveryPanel`（New）

```ts
export type DeviceDiscoveryPanelProps = {
  snapshot: DiscoverySnapshot;
  existingDeviceIds: string[];
  onRefresh: () => void;
  onToggleIpScan: () => void;
  onStartScan: (cidr: string) => void;
  onSelect: (device: DiscoveredDevice) => void; // fill manual form
};
```
